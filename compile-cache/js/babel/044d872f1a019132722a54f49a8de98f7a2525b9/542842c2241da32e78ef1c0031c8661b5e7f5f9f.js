'use babel';
'use strict';

var _ = require('lodash');
var View = require('atom-space-pen-views').View;
var $ = require('atom-space-pen-views').$;
var ansi_up = require('ansi_up');
var cscompatability = require('./cscompatability');
var GoogleAnalytics = require('./google-analytics');

module.exports = (function () {
  function BuildView() {
    View.apply(this, arguments);
    this.titleLoop = ['Building', 'Building.', 'Building..', 'Building...'];
    this.titleLoop.rotate = function () {
      /* Throttle as we don't want to update as quick as the timer is */
      this.n = this.n || 0;
      ++this.n === 3 && this.push(this.shift()) && (this.n = 0);
    };
    this.monocle = false;
    this.starttime = new Date();
    this.buffer = new Buffer(0);
    this.links = [];

    this._setMonocleIcon();

    atom.config.observe('build.panelVisibility', this.visibleFromConfig.bind(this));
    atom.config.observe('build.panelOrientation', this.orientationFromConfig.bind(this));
    atom.config.observe('build.monocleHeight', this.sizeFromConfig.bind(this));
    atom.config.observe('build.minimizedHeight', this.sizeFromConfig.bind(this));
    atom.config.observe('editor.fontFamily', this.fontFromConfig.bind(this));

    atom.commands.add('atom-workspace', 'build:toggle-panel', this.toggle.bind(this));
  }

  cscompatability['extends'](BuildView, View);

  BuildView.content = function () {
    BuildView.div({ tabIndex: -1, 'class': 'build tool-panel panel-bottom native-key-bindings' }, function () {
      BuildView.div({ 'class': 'btn-container pull-right' }, function () {
        BuildView.button({ 'class': 'btn btn-default icon icon-x', click: 'close' });
        BuildView.button({ 'class': 'btn btn-default icon icon-chevron-up', outlet: 'monocleButton', click: 'toggleMonocle' });
        BuildView.button({ 'class': 'btn btn-default icon icon-trashcan new-row', click: 'clear' });
        BuildView.button({ 'class': 'btn btn-default icon icon-zap', click: 'build', title: 'Build current project' });
      });

      BuildView.div({ 'class': 'output panel-body', outlet: 'output' });

      BuildView.div({ 'class': 'status' }, function () {
        BuildView.h1({ 'class': 'title panel-heading', outlet: 'title' }, function () {
          BuildView.span({ 'class': 'build-timer', outlet: 'buildTimer' }, '0.0 s');
          BuildView.span({ 'class': 'title-text', outlet: 'titleText' }, 'Ready');
        });
      });
    });
  };

  BuildView.prototype.attach = function (force) {
    if (!force) {
      switch (atom.config.get('build.panelVisibility')) {
        case 'Hidden':
        case 'Show on Error':
          return;
      }
    }

    if (this.panel) {
      this.panel.destroy();
    }
    var addfn = {
      Top: atom.workspace.addTopPanel,
      Bottom: atom.workspace.addBottomPanel,
      Left: atom.workspace.addLeftPanel,
      Right: atom.workspace.addRightPanel
    };
    var orientation = atom.config.get('build.panelOrientation') || 'Bottom';
    this.panel = addfn[orientation].call(atom.workspace, { item: this });
    this.sizeFromConfig();
    this.fontFromConfig();
  };

  BuildView.prototype.detach = function (force) {
    force = force || false;
    if (atom.views.getView(atom.workspace)) {
      atom.views.getView(atom.workspace).focus();
    }
    if (this.panel && (force || 'Keep Visible' !== atom.config.get('build.panelVisibility'))) {
      this.panel.destroy();
      this.panel = null;
    }
  };

  BuildView.prototype.isAttached = function () {
    return !!this.panel;
  };

  BuildView.prototype.sizeFromConfig = function () {
    this.setSizePercent(atom.config.get(this.monocle ? 'build.monocleHeight' : 'build.minimizedHeight'));
  };

  BuildView.prototype.fontFromConfig = function () {
    this.output.css('font-family', atom.config.get('editor.fontFamily'));
  };

  BuildView.prototype.visibleFromConfig = function (val) {
    switch (val) {
      case 'Toggle':
      case 'Show on Error':
        if (!this.title.hasClass('error')) {
          this.detach();
        }
        break;
    }
  };

  BuildView.prototype.orientationFromConfig = function (val) {
    var isVisible = this.isVisible();
    this.detach(true);
    if (isVisible) {
      this.attach();
      this._setMonocleIcon();
    }
  };

  BuildView.prototype.reset = function () {
    clearTimeout(this.titleTimer);
    this.buffer = new Buffer(0);
    this.links = [];
    this.titleTimer = 0;
    this.title.removeClass('success error warning');
    this.output.empty();
    this.titleText.text('Cleared.');
    this.detach();
  };

  BuildView.prototype.updateTitle = function () {
    this.titleText.text(this.titleLoop[0]);
    this.titleLoop.rotate();
    this.buildTimer.text(((new Date() - this.starttime) / 1000).toFixed(1) + ' s');
    this.titleTimer = setTimeout(this.updateTitle.bind(this), 100);
  };

  BuildView.prototype.close = function (event, element) {
    this.detach(true);
  };

  BuildView.prototype.toggle = function (event, element) {
    GoogleAnalytics.sendEvent('view', 'panel toggled');
    this.isAttached() ? this.detach(true) : this.attach(true);
  };

  BuildView.prototype.clear = function (event, element) {
    this.reset();
    this.attach();
  };

  BuildView.prototype.build = function (event, element) {
    atom.commands.dispatch(atom.views.getView(atom.workspace), 'build:trigger');
  };

  BuildView.prototype.setSizePercent = function (percent) {
    var size = 0,
        cssKey = 'height';
    switch (atom.config.get('build.panelOrientation')) {
      case 'Top':
      case 'Bottom':
        size = $('atom-workspace-axis.vertical').height();
        cssKey = 'height';
        break;

      case 'Left':
      case 'Right':
        size = $('atom-workspace-axis.vertical').width();
        if ($('.build').length) {
          size += $('.build').get(0).clientWidth;
        }
        cssKey = 'width';
        break;
    }
    this.output.css('width', 'auto');
    this.output.css('height', '100%');
    this.output.css(cssKey, percent * size + 'px');
  };

  BuildView.prototype._setMonocleIcon = function () {
    var _this = this;

    var iconName = function iconName() {
      switch (atom.config.get('build.panelOrientation')) {
        case 'Top':
          return _this.monocle ? 'icon-chevron-up' : 'icon-chevron-down';
        case 'Bottom':
          return _this.monocle ? 'icon-chevron-down' : 'icon-chevron-up';
        case 'Right':
          return _this.monocle ? 'icon-chevron-right' : 'icon-chevron-left';
        case 'Left':
          return _this.monocle ? 'icon-chevron-left' : 'icon-chevron-right';
      }
    };

    this.monocleButton.removeClass('icon-chevron-down icon-chevron-up icon-chevron-left icon-chevron-right').addClass(iconName());
  };

  BuildView.prototype.toggleMonocle = function (event, element) {
    GoogleAnalytics.sendEvent('view', 'monocle toggled');
    this.monocle = !this.monocle;
    this.setSizePercent(atom.config.get(this.monocle ? 'build.monocleHeight' : 'build.minimizedHeight'));
    this._setMonocleIcon();
  };

  BuildView.prototype.buildStarted = function () {
    this.starttime = new Date();
    this.reset();
    this.attach();
    if (atom.config.get('build.stealFocus')) {
      this.focus();
    }
    this.updateTitle();
  };

  BuildView.prototype.buildFinished = function (success) {
    if (!success) {
      var force = atom.config.get('build.panelVisibility') === 'Show on Error';
      this.attach(force);
    }
    this.titleText.text(success ? 'Build finished.' : 'Build failed.');
    this.title.addClass(success ? 'success' : 'error');
    clearTimeout(this.titleTimer);
  };

  BuildView.prototype.buildAbortInitiated = function () {
    this.titleText.text('Build process termination imminent...');
    clearTimeout(this.titleTimer);
    this.title.addClass('error');
  };

  BuildView.prototype.buildAborted = function () {
    this.titleText.text('Aborted!');
  };

  BuildView.prototype._render = function () {
    var _this2 = this;

    var string = _.escape(this.buffer.toString('utf8'));
    _.forEach(this.links, function (link, index) {
      var replaceRegex = new RegExp(_.escapeRegExp(_.escape(link.text)), 'g');
      string = string.replace(replaceRegex, '<a id="' + link.id + '">' + _.escape(link.text) + '</a>');
    });
    this.output.html(ansi_up.ansi_to_html(string));
    this.output.find('a').on('click', function (event) {
      var link = _.findWhere(_this2.links, { id: event.currentTarget.id });
      link.onClick();
    });
  };

  BuildView.prototype.append = function (data) {
    this.buffer = Buffer.concat([this.buffer, Buffer.isBuffer(data) ? data : new Buffer(data)]);
    this._render();
    this.output.scrollTop(this.output[0].scrollHeight);
  };

  BuildView.prototype.link = function (text, id, onClick) {
    if (_.findWhere(this.links, { text: text })) {
      /* This text already has a link to it. Ignore it. */
      return;
    }

    this.links.push({
      id: id,
      text: text,
      onClick: onClick
    });
    this._render();
  };

  BuildView.prototype.scrollTo = function (id) {
    var position = this.output.find('#' + id).position();
    if (position) {
      this.output.scrollTop(position.top + this.output.scrollTop());
    }
  };

  return BuildView;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2NoYW1wLy5hdG9tL3BhY2thZ2VzL2J1aWxkL2xpYi9idWlsZC12aWV3LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQztBQUNaLFlBQVksQ0FBQzs7QUFFYixJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDMUIsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ2hELElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxQyxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDakMsSUFBSSxlQUFlLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDbkQsSUFBSSxlQUFlLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7O0FBRXBELE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxZQUFXO0FBQzNCLFdBQVMsU0FBUyxHQUFHO0FBQ25CLFFBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQzVCLFFBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxhQUFhLENBQUUsQ0FBQztBQUMxRSxRQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxZQUFZOztBQUVsQyxVQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3JCLEFBQUMsUUFBRSxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBLEFBQUMsQ0FBQztLQUM3RCxDQUFDO0FBQ0YsUUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7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Q0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO0dBQ3BELENBQUM7O0FBRUYsV0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsVUFBUyxJQUFJLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRTtBQUNyRCxRQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFOztBQUUzQyxhQUFPO0tBQ1I7O0FBRUQsUUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7QUFDZCxRQUFFLEVBQUUsRUFBRTtBQUNOLFVBQUksRUFBRSxJQUFJO0FBQ1YsYUFBTyxFQUFFLE9BQU87S0FDakIsQ0FBQyxDQUFDO0FBQ0gsUUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0dBQ2hCLENBQUM7O0FBRUYsV0FBUyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsVUFBUyxFQUFFLEVBQUU7QUFDMUMsUUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ3JELFFBQUksUUFBUSxFQUFFO0FBQ1osVUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7S0FDL0Q7R0FDRixDQUFDOztBQUVGLFNBQU8sU0FBUyxDQUFDO0NBQ2xCLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6Ii9ob21lL2NoYW1wLy5hdG9tL3BhY2thZ2VzL2J1aWxkL2xpYi9idWlsZC12aWV3LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG52YXIgVmlldyA9IHJlcXVpcmUoJ2F0b20tc3BhY2UtcGVuLXZpZXdzJykuVmlldztcbnZhciAkID0gcmVxdWlyZSgnYXRvbS1zcGFjZS1wZW4tdmlld3MnKS4kO1xudmFyIGFuc2lfdXAgPSByZXF1aXJlKCdhbnNpX3VwJyk7XG52YXIgY3Njb21wYXRhYmlsaXR5ID0gcmVxdWlyZSgnLi9jc2NvbXBhdGFiaWxpdHknKTtcbnZhciBHb29nbGVBbmFseXRpY3MgPSByZXF1aXJlKCcuL2dvb2dsZS1hbmFseXRpY3MnKTtcblxubW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIEJ1aWxkVmlldygpIHtcbiAgICBWaWV3LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgdGhpcy50aXRsZUxvb3AgPSBbICdCdWlsZGluZycsICdCdWlsZGluZy4nLCAnQnVpbGRpbmcuLicsICdCdWlsZGluZy4uLicgXTtcbiAgICB0aGlzLnRpdGxlTG9vcC5yb3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvKiBUaHJvdHRsZSBhcyB3ZSBkb24ndCB3YW50IHRvIHVwZGF0ZSBhcyBxdWljayBhcyB0aGUgdGltZXIgaXMgKi9cbiAgICAgIHRoaXMubiA9IHRoaXMubiB8fCAwO1xuICAgICAgKCsrdGhpcy5uID09PSAzKSAmJiB0aGlzLnB1c2godGhpcy5zaGlmdCgpKSAmJiAodGhpcy5uID0gMCk7XG4gICAgfTtcbiAgICB0aGlzLm1vbm9jbGUgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXJ0dGltZSA9IG5ldyBEYXRlKCk7XG4gICAgdGhpcy5idWZmZXIgPSBuZXcgQnVmZmVyKDApO1xuICAgIHRoaXMubGlua3MgPSBbXTtcblxuICAgIHRoaXMuX3NldE1vbm9jbGVJY29uKCk7XG5cbiAgICBhdG9tLmNvbmZpZy5vYnNlcnZlKCdidWlsZC5wYW5lbFZpc2liaWxpdHknLCB0aGlzLnZpc2libGVGcm9tQ29uZmlnLmJpbmQodGhpcykpO1xuICAgIGF0b20uY29uZmlnLm9ic2VydmUoJ2J1aWxkLnBhbmVsT3JpZW50YXRpb24nLCB0aGlzLm9yaWVudGF0aW9uRnJvbUNvbmZpZy5iaW5kKHRoaXMpKTtcbiAgICBhdG9tLmNvbmZpZy5vYnNlcnZlKCdidWlsZC5tb25vY2xlSGVpZ2h0JywgdGhpcy5zaXplRnJvbUNvbmZpZy5iaW5kKHRoaXMpKTtcbiAgICBhdG9tLmNvbmZpZy5vYnNlcnZlKCdidWlsZC5taW5pbWl6ZWRIZWlnaHQnLCB0aGlzLnNpemVGcm9tQ29uZmlnLmJpbmQodGhpcykpO1xuICAgIGF0b20uY29uZmlnLm9ic2VydmUoJ2VkaXRvci5mb250RmFtaWx5JywgdGhpcy5mb250RnJvbUNvbmZpZy5iaW5kKHRoaXMpKTtcblxuICAgIGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdidWlsZDp0b2dnbGUtcGFuZWwnLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIGNzY29tcGF0YWJpbGl0eS5leHRlbmRzKEJ1aWxkVmlldywgVmlldyk7XG5cbiAgQnVpbGRWaWV3LmNvbnRlbnQgPSBmdW5jdGlvbigpIHtcbiAgICBCdWlsZFZpZXcuZGl2KHsgdGFiSW5kZXg6IC0xLCBjbGFzczogJ2J1aWxkIHRvb2wtcGFuZWwgcGFuZWwtYm90dG9tIG5hdGl2ZS1rZXktYmluZGluZ3MnIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgQnVpbGRWaWV3LmRpdih7IGNsYXNzOiAnYnRuLWNvbnRhaW5lciBwdWxsLXJpZ2h0JyB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgQnVpbGRWaWV3LmJ1dHRvbih7IGNsYXNzOiAnYnRuIGJ0bi1kZWZhdWx0IGljb24gaWNvbi14JywgY2xpY2s6ICdjbG9zZScgfSk7XG4gICAgICAgIEJ1aWxkVmlldy5idXR0b24oeyBjbGFzczogJ2J0biBidG4tZGVmYXVsdCBpY29uIGljb24tY2hldnJvbi11cCcsIG91dGxldDogJ21vbm9jbGVCdXR0b24nLCBjbGljazogJ3RvZ2dsZU1vbm9jbGUnIH0pO1xuICAgICAgICBCdWlsZFZpZXcuYnV0dG9uKHsgY2xhc3M6ICdidG4gYnRuLWRlZmF1bHQgaWNvbiBpY29uLXRyYXNoY2FuIG5ldy1yb3cnLCBjbGljazogJ2NsZWFyJyB9KTtcbiAgICAgICAgQnVpbGRWaWV3LmJ1dHRvbih7IGNsYXNzOiAnYnRuIGJ0bi1kZWZhdWx0IGljb24gaWNvbi16YXAnLCBjbGljazogJ2J1aWxkJywgdGl0bGU6ICdCdWlsZCBjdXJyZW50IHByb2plY3QnIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIEJ1aWxkVmlldy5kaXYoeyBjbGFzczogJ291dHB1dCBwYW5lbC1ib2R5Jywgb3V0bGV0OiAnb3V0cHV0JyB9KTtcblxuICAgICAgQnVpbGRWaWV3LmRpdih7IGNsYXNzOiAnc3RhdHVzJyB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgQnVpbGRWaWV3LmgxKHsgY2xhc3M6ICd0aXRsZSBwYW5lbC1oZWFkaW5nJywgb3V0bGV0OiAndGl0bGUnIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBCdWlsZFZpZXcuc3Bhbih7IGNsYXNzOiAnYnVpbGQtdGltZXInLCBvdXRsZXQ6ICdidWlsZFRpbWVyJyB9LCAnMC4wIHMnKTtcbiAgICAgICAgICBCdWlsZFZpZXcuc3Bhbih7IGNsYXNzOiAndGl0bGUtdGV4dCcsIG91dGxldDogJ3RpdGxlVGV4dCcgfSwgJ1JlYWR5Jyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5hdHRhY2ggPSBmdW5jdGlvbihmb3JjZSkge1xuICAgIGlmICghZm9yY2UpIHtcbiAgICAgIHN3aXRjaCAoYXRvbS5jb25maWcuZ2V0KCdidWlsZC5wYW5lbFZpc2liaWxpdHknKSkge1xuICAgICAgICBjYXNlICdIaWRkZW4nOlxuICAgICAgICBjYXNlICdTaG93IG9uIEVycm9yJzpcbiAgICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucGFuZWwpIHtcbiAgICAgIHRoaXMucGFuZWwuZGVzdHJveSgpO1xuICAgIH1cbiAgICBsZXQgYWRkZm4gPSB7XG4gICAgICBUb3A6IGF0b20ud29ya3NwYWNlLmFkZFRvcFBhbmVsLFxuICAgICAgQm90dG9tOiBhdG9tLndvcmtzcGFjZS5hZGRCb3R0b21QYW5lbCxcbiAgICAgIExlZnQ6IGF0b20ud29ya3NwYWNlLmFkZExlZnRQYW5lbCxcbiAgICAgIFJpZ2h0OiBhdG9tLndvcmtzcGFjZS5hZGRSaWdodFBhbmVsXG4gICAgfTtcbiAgICBsZXQgb3JpZW50YXRpb24gPSBhdG9tLmNvbmZpZy5nZXQoJ2J1aWxkLnBhbmVsT3JpZW50YXRpb24nKSB8fCAnQm90dG9tJztcbiAgICB0aGlzLnBhbmVsID0gYWRkZm5bb3JpZW50YXRpb25dLmNhbGwoYXRvbS53b3Jrc3BhY2UsIHsgaXRlbTogdGhpcyB9KTtcbiAgICB0aGlzLnNpemVGcm9tQ29uZmlnKCk7XG4gICAgdGhpcy5mb250RnJvbUNvbmZpZygpO1xuICB9O1xuXG4gIEJ1aWxkVmlldy5wcm90b3R5cGUuZGV0YWNoID0gZnVuY3Rpb24oZm9yY2UpIHtcbiAgICBmb3JjZSA9IGZvcmNlIHx8wqBmYWxzZTtcbiAgICBpZiAoYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKSkge1xuICAgICAgYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKS5mb2N1cygpO1xuICAgIH1cbiAgICBpZiAodGhpcy5wYW5lbCAmJiAoZm9yY2UgfHwgJ0tlZXAgVmlzaWJsZScgIT09IGF0b20uY29uZmlnLmdldCgnYnVpbGQucGFuZWxWaXNpYmlsaXR5JykpKSB7XG4gICAgICB0aGlzLnBhbmVsLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMucGFuZWwgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmlzQXR0YWNoZWQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gISF0aGlzLnBhbmVsO1xuICB9O1xuXG4gIEJ1aWxkVmlldy5wcm90b3R5cGUuc2l6ZUZyb21Db25maWcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldFNpemVQZXJjZW50KGF0b20uY29uZmlnLmdldCh0aGlzLm1vbm9jbGUgPyAnYnVpbGQubW9ub2NsZUhlaWdodCcgOiAnYnVpbGQubWluaW1pemVkSGVpZ2h0JykpO1xuICB9O1xuXG4gIEJ1aWxkVmlldy5wcm90b3R5cGUuZm9udEZyb21Db25maWcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm91dHB1dC5jc3MoJ2ZvbnQtZmFtaWx5JywgYXRvbS5jb25maWcuZ2V0KCdlZGl0b3IuZm9udEZhbWlseScpKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLnZpc2libGVGcm9tQ29uZmlnID0gZnVuY3Rpb24odmFsKSB7XG4gICAgc3dpdGNoICh2YWwpIHtcbiAgICAgIGNhc2UgJ1RvZ2dsZSc6XG4gICAgICBjYXNlICdTaG93IG9uIEVycm9yJzpcbiAgICAgICAgaWYgKCF0aGlzLnRpdGxlLmhhc0NsYXNzKCdlcnJvcicpKSB7XG4gICAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5vcmllbnRhdGlvbkZyb21Db25maWcgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgbGV0IGlzVmlzaWJsZSA9IHRoaXMuaXNWaXNpYmxlKCk7XG4gICAgdGhpcy5kZXRhY2godHJ1ZSk7XG4gICAgaWYgKGlzVmlzaWJsZSkge1xuICAgICAgdGhpcy5hdHRhY2goKTtcbiAgICAgIHRoaXMuX3NldE1vbm9jbGVJY29uKCk7XG4gICAgfVxuICB9O1xuXG4gIEJ1aWxkVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aXRsZVRpbWVyKTtcbiAgICB0aGlzLmJ1ZmZlciA9IG5ldyBCdWZmZXIoMCk7XG4gICAgdGhpcy5saW5rcyA9IFtdO1xuICAgIHRoaXMudGl0bGVUaW1lciA9IDA7XG4gICAgdGhpcy50aXRsZS5yZW1vdmVDbGFzcygnc3VjY2VzcyBlcnJvciB3YXJuaW5nJyk7XG4gICAgdGhpcy5vdXRwdXQuZW1wdHkoKTtcbiAgICB0aGlzLnRpdGxlVGV4dC50ZXh0KCdDbGVhcmVkLicpO1xuICAgIHRoaXMuZGV0YWNoKCk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS51cGRhdGVUaXRsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGl0bGVUZXh0LnRleHQodGhpcy50aXRsZUxvb3BbMF0pO1xuICAgIHRoaXMudGl0bGVMb29wLnJvdGF0ZSgpO1xuICAgIHRoaXMuYnVpbGRUaW1lci50ZXh0KCgobmV3IERhdGUoKSAtIHRoaXMuc3RhcnR0aW1lKSAvIDEwMDApLnRvRml4ZWQoMSkgKyAnIHMnKTtcbiAgICB0aGlzLnRpdGxlVGltZXIgPSBzZXRUaW1lb3V0KHRoaXMudXBkYXRlVGl0bGUuYmluZCh0aGlzKSwgMTAwKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICB0aGlzLmRldGFjaCh0cnVlKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgR29vZ2xlQW5hbHl0aWNzLnNlbmRFdmVudCgndmlldycsICdwYW5lbCB0b2dnbGVkJyk7XG4gICAgdGhpcy5pc0F0dGFjaGVkKCkgPyAgdGhpcy5kZXRhY2godHJ1ZSkgOiB0aGlzLmF0dGFjaCh0cnVlKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICB0aGlzLnJlc2V0KCk7XG4gICAgdGhpcy5hdHRhY2goKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGF0b20udmlld3MuZ2V0VmlldyhhdG9tLndvcmtzcGFjZSksICdidWlsZDp0cmlnZ2VyJyk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5zZXRTaXplUGVyY2VudCA9IGZ1bmN0aW9uKHBlcmNlbnQpIHtcbiAgICBsZXQgc2l6ZSA9IDAsIGNzc0tleSA9ICdoZWlnaHQnO1xuICAgIHN3aXRjaCAoYXRvbS5jb25maWcuZ2V0KCdidWlsZC5wYW5lbE9yaWVudGF0aW9uJykpIHtcbiAgICAgIGNhc2UgJ1RvcCc6XG4gICAgICBjYXNlICdCb3R0b20nOlxuICAgICAgICBzaXplID0gJCgnYXRvbS13b3Jrc3BhY2UtYXhpcy52ZXJ0aWNhbCcpLmhlaWdodCgpO1xuICAgICAgICBjc3NLZXkgPSAnaGVpZ2h0JztcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0xlZnQnOlxuICAgICAgY2FzZSAnUmlnaHQnOlxuICAgICAgICBzaXplID0gJCgnYXRvbS13b3Jrc3BhY2UtYXhpcy52ZXJ0aWNhbCcpLndpZHRoKCk7XG4gICAgICAgIGlmICgkKCcuYnVpbGQnKS5sZW5ndGgpIHtcbiAgICAgICAgICBzaXplICs9ICQoJy5idWlsZCcpLmdldCgwKS5jbGllbnRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICBjc3NLZXkgPSAnd2lkdGgnO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgdGhpcy5vdXRwdXQuY3NzKCd3aWR0aCcsICdhdXRvJyk7XG4gICAgdGhpcy5vdXRwdXQuY3NzKCdoZWlnaHQnLCAnMTAwJScpO1xuICAgIHRoaXMub3V0cHV0LmNzcyhjc3NLZXksIHBlcmNlbnQgKiBzaXplICsgJ3B4Jyk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5fc2V0TW9ub2NsZUljb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGljb25OYW1lID0gKCkgPT4ge1xuICAgICAgc3dpdGNoIChhdG9tLmNvbmZpZy5nZXQoJ2J1aWxkLnBhbmVsT3JpZW50YXRpb24nKSkge1xuICAgICAgICBjYXNlICdUb3AnOiByZXR1cm4gdGhpcy5tb25vY2xlID8gJ2ljb24tY2hldnJvbi11cCcgOiAnaWNvbi1jaGV2cm9uLWRvd24nO1xuICAgICAgICBjYXNlICdCb3R0b20nOiByZXR1cm4gdGhpcy5tb25vY2xlID8gJ2ljb24tY2hldnJvbi1kb3duJyA6ICdpY29uLWNoZXZyb24tdXAnO1xuICAgICAgICBjYXNlICdSaWdodCc6IHJldHVybiB0aGlzLm1vbm9jbGUgPyAnaWNvbi1jaGV2cm9uLXJpZ2h0JyA6ICdpY29uLWNoZXZyb24tbGVmdCc7XG4gICAgICAgIGNhc2UgJ0xlZnQnOiByZXR1cm4gdGhpcy5tb25vY2xlID8gJ2ljb24tY2hldnJvbi1sZWZ0JyA6ICdpY29uLWNoZXZyb24tcmlnaHQnO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLm1vbm9jbGVCdXR0b25cbiAgICAgIC5yZW1vdmVDbGFzcygnaWNvbi1jaGV2cm9uLWRvd24gaWNvbi1jaGV2cm9uLXVwIGljb24tY2hldnJvbi1sZWZ0IGljb24tY2hldnJvbi1yaWdodCcpXG4gICAgICAuYWRkQ2xhc3MoaWNvbk5hbWUoKSk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS50b2dnbGVNb25vY2xlID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICBHb29nbGVBbmFseXRpY3Muc2VuZEV2ZW50KCd2aWV3JywgJ21vbm9jbGUgdG9nZ2xlZCcpO1xuICAgIHRoaXMubW9ub2NsZSA9ICF0aGlzLm1vbm9jbGU7XG4gICAgdGhpcy5zZXRTaXplUGVyY2VudChhdG9tLmNvbmZpZy5nZXQodGhpcy5tb25vY2xlID8gJ2J1aWxkLm1vbm9jbGVIZWlnaHQnIDogJ2J1aWxkLm1pbmltaXplZEhlaWdodCcpKTtcbiAgICB0aGlzLl9zZXRNb25vY2xlSWNvbigpO1xuICB9O1xuXG4gIEJ1aWxkVmlldy5wcm90b3R5cGUuYnVpbGRTdGFydGVkID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zdGFydHRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXMucmVzZXQoKTtcbiAgICB0aGlzLmF0dGFjaCgpO1xuICAgIGlmIChhdG9tLmNvbmZpZy5nZXQoJ2J1aWxkLnN0ZWFsRm9jdXMnKSkge1xuICAgICAgdGhpcy5mb2N1cygpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZVRpdGxlKCk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5idWlsZEZpbmlzaGVkID0gZnVuY3Rpb24oc3VjY2Vzcykge1xuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgdmFyIGZvcmNlID0gKGF0b20uY29uZmlnLmdldCgnYnVpbGQucGFuZWxWaXNpYmlsaXR5JykgPT09ICdTaG93IG9uIEVycm9yJyk7XG4gICAgICB0aGlzLmF0dGFjaChmb3JjZSk7XG4gICAgfVxuICAgIHRoaXMudGl0bGVUZXh0LnRleHQoc3VjY2VzcyA/ICdCdWlsZCBmaW5pc2hlZC4nIDogJ0J1aWxkIGZhaWxlZC4nKTtcbiAgICB0aGlzLnRpdGxlLmFkZENsYXNzKHN1Y2Nlc3MgPyAnc3VjY2VzcycgOiAnZXJyb3InKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aXRsZVRpbWVyKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmJ1aWxkQWJvcnRJbml0aWF0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRpdGxlVGV4dC50ZXh0KCdCdWlsZCBwcm9jZXNzIHRlcm1pbmF0aW9uIGltbWluZW50Li4uJyk7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMudGl0bGVUaW1lcik7XG4gICAgdGhpcy50aXRsZS5hZGRDbGFzcygnZXJyb3InKTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmJ1aWxkQWJvcnRlZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGl0bGVUZXh0LnRleHQoJ0Fib3J0ZWQhJyk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0cmluZyA9IF8uZXNjYXBlKHRoaXMuYnVmZmVyLnRvU3RyaW5nKCd1dGY4JykpO1xuICAgIF8uZm9yRWFjaCh0aGlzLmxpbmtzLCBmdW5jdGlvbiAobGluaywgaW5kZXgpIHtcbiAgICAgIHZhciByZXBsYWNlUmVnZXggPSBuZXcgUmVnRXhwKF8uZXNjYXBlUmVnRXhwKF8uZXNjYXBlKGxpbmsudGV4dCkpLCAnZycpO1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UocmVwbGFjZVJlZ2V4LCAnPGEgaWQ9XCInICsgbGluay5pZCArICdcIj4nICsgXy5lc2NhcGUobGluay50ZXh0KSArICc8L2E+Jyk7XG4gICAgfSk7XG4gICAgdGhpcy5vdXRwdXQuaHRtbChhbnNpX3VwLmFuc2lfdG9faHRtbChzdHJpbmcpKTtcbiAgICB0aGlzLm91dHB1dC5maW5kKCdhJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICB2YXIgbGluayA9IF8uZmluZFdoZXJlKHRoaXMubGlua3MsIHsgaWQ6IGV2ZW50LmN1cnJlbnRUYXJnZXQuaWQgfSk7XG4gICAgICBsaW5rLm9uQ2xpY2soKTtcbiAgICB9KTtcbiAgfTtcblxuICBCdWlsZFZpZXcucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB0aGlzLmJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoWyB0aGlzLmJ1ZmZlciwgQnVmZmVyLmlzQnVmZmVyKGRhdGEpID8gZGF0YSA6IG5ldyBCdWZmZXIoZGF0YSkgXSk7XG4gICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgdGhpcy5vdXRwdXQuc2Nyb2xsVG9wKHRoaXMub3V0cHV0WzBdLnNjcm9sbEhlaWdodCk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5saW5rID0gZnVuY3Rpb24odGV4dCwgaWQsIG9uQ2xpY2spIHtcbiAgICBpZiAoXy5maW5kV2hlcmUodGhpcy5saW5rcywgeyB0ZXh0OiB0ZXh0IH0pKSB7XG4gICAgICAvKiBUaGlzIHRleHQgYWxyZWFkeSBoYXMgYSBsaW5rIHRvIGl0LiBJZ25vcmUgaXQuICovXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5saW5rcy5wdXNoKHtcbiAgICAgIGlkOiBpZCxcbiAgICAgIHRleHQ6IHRleHQsXG4gICAgICBvbkNsaWNrOiBvbkNsaWNrXG4gICAgfSk7XG4gICAgdGhpcy5fcmVuZGVyKCk7XG4gIH07XG5cbiAgQnVpbGRWaWV3LnByb3RvdHlwZS5zY3JvbGxUbyA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgdmFyIHBvc2l0aW9uID0gdGhpcy5vdXRwdXQuZmluZCgnIycgKyBpZCkucG9zaXRpb24oKTtcbiAgICBpZiAocG9zaXRpb24pIHtcbiAgICAgIHRoaXMub3V0cHV0LnNjcm9sbFRvcChwb3NpdGlvbi50b3AgKyB0aGlzLm91dHB1dC5zY3JvbGxUb3AoKSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBCdWlsZFZpZXc7XG59KSgpO1xuIl19
//# sourceURL=/home/champ/.atom/packages/build/lib/build-view.js
