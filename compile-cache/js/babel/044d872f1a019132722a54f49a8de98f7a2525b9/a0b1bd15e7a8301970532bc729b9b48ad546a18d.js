'use babel';
'use strict';

var fs = require('fs');
var path = require('path');
var XRegExp = require('xregexp').XRegExp;
var GoogleAnalytics = require('./google-analytics');
var EventEmitter = require('events').EventEmitter;
var util = require('util');
var _ = require('lodash');

module.exports = (function () {

  function ErrorMatcher() {
    this.regex = null;
    this.cwd = null;
    this.stdout = null;
    this.stderr = null;
    this.currentMatch = [];
    this.firstMatchId = null;

    atom.commands.add('atom-workspace', 'build:error-match', this.match.bind(this));
    atom.commands.add('atom-workspace', 'build:error-match-first', this.matchFirst.bind(this));
  }

  util.inherits(ErrorMatcher, EventEmitter);

  ErrorMatcher.prototype._gotoNext = function () {
    if (0 === this.currentMatch.length) {
      return;
    }

    this.goto(this.currentMatch[0].id);
  };

  ErrorMatcher.prototype.goto = function (id) {
    var _this = this;

    var match = _.findWhere(this.currentMatch, { id: id });
    if (!match) {
      return this.emit('error', 'Can\'t find match with id ' + id);
    }

    // rotate to next match
    while (this.currentMatch[0] !== match) {
      this.currentMatch.push(this.currentMatch.shift());
    }
    this.currentMatch.push(this.currentMatch.shift());

    var file = match.file;
    if (!file) {
      return this.emit('error', 'Did not match any file. Don\'t know what to open.');
    }

    if (!path.isAbsolute(file)) {
      file = this.cwd + path.sep + file;
    }

    var row = match.line ? match.line - 1 : 0; /* Because atom is zero-based */
    var col = match.col ? match.col - 1 : 0; /* Because atom is zero-based */

    fs.exists(file, function (exists) {
      if (!exists) {
        return _this.emit('error', 'Matched file does not exist: ' + file);
      }
      atom.workspace.open(file, {
        initialLine: row,
        initialColumn: col,
        searchAllPanes: true
      });
      _this.emit('matched', match.id);
    });
  };

  ErrorMatcher.prototype._parse = function () {
    var _this2 = this;

    this.currentMatch = [];
    var self = this;
    var matchFunction = function matchFunction(match, i, string, regex) {
      match.id = 'error-match-' + self.regex.indexOf(regex) + '-' + i;
      this.push(match);
    };
    this.regex.forEach(function (regex) {
      XRegExp.forEach(_this2.output, regex, matchFunction, _this2.currentMatch);
    });

    this.currentMatch.sort(function (a, b) {
      return a.index - b.index;
    });

    this.firstMatchId = this.currentMatch.length > 0 ? this.currentMatch[0].id : null;

    _.forEach(this.currentMatch, function (match, index) {
      _this2.emit('match', match[0], match.id);
    });
  };

  ErrorMatcher.prototype.set = function (regex, cwd, output) {
    var _this3 = this;

    if (!regex) {
      regex = [];
    }
    regex = regex instanceof Array ? regex : [regex];

    this.regex = _.compact(regex.map(function (r) {
      try {
        return XRegExp(r);
      } catch (err) {
        _this3.emit('error', 'Error parsing regex. ' + err.message);
        return null;
      }
    }));

    this.cwd = cwd;
    this.output = output;
    this.currentMatch = [];

    this._parse();
  };

  ErrorMatcher.prototype.match = function () {
    GoogleAnalytics.sendEvent('errorMatch', 'match');

    this._gotoNext();
  };

  ErrorMatcher.prototype.matchFirst = function () {
    GoogleAnalytics.sendEvent('errorMatch', 'first');

    if (this.firstMatchId) {
      this.goto(this.firstMatchId);
    }
  };

  ErrorMatcher.prototype.hasMatch = function () {
    return 0 !== this.currentMatch.length;
  };

  return ErrorMatcher;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2NoYW1wLy5hdG9tL3BhY2thZ2VzL2J1aWxkL2xpYi9lcnJvci1tYXRjaGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQztBQUNaLFlBQVksQ0FBQzs7QUFFYixJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDdkIsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzNCLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDekMsSUFBSSxlQUFlLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFDcEQsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQztBQUNsRCxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDM0IsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztBQUUxQixNQUFNLENBQUMsT0FBTyxHQUFHLENBQUMsWUFBWTs7QUFFNUIsV0FBUyxZQUFZLEdBQUc7QUFDdEIsUUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7QUFDbEIsUUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7QUFDaEIsUUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDbkIsUUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDbkIsUUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7QUFDdkIsUUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7O0FBRXpCLFFBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLG1CQUFtQixFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDaEYsUUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMs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ZXMvYnVpbGQvbGliL2Vycm9yLW1hdGNoZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcbid1c2Ugc3RyaWN0JztcblxudmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xudmFyIFhSZWdFeHAgPSByZXF1aXJlKCd4cmVnZXhwJykuWFJlZ0V4cDtcbnZhciBHb29nbGVBbmFseXRpY3MgPSByZXF1aXJlKCcuL2dvb2dsZS1hbmFseXRpY3MnKTtcbnZhciBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKS5FdmVudEVtaXR0ZXI7XG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uICgpIHtcblxuICBmdW5jdGlvbiBFcnJvck1hdGNoZXIoKSB7XG4gICAgdGhpcy5yZWdleCA9IG51bGw7XG4gICAgdGhpcy5jd2QgPSBudWxsO1xuICAgIHRoaXMuc3Rkb3V0ID0gbnVsbDtcbiAgICB0aGlzLnN0ZGVyciA9IG51bGw7XG4gICAgdGhpcy5jdXJyZW50TWF0Y2ggPSBbXTtcbiAgICB0aGlzLmZpcnN0TWF0Y2hJZCA9IG51bGw7XG5cbiAgICBhdG9tLmNvbW1hbmRzLmFkZCgnYXRvbS13b3Jrc3BhY2UnLCAnYnVpbGQ6ZXJyb3ItbWF0Y2gnLCB0aGlzLm1hdGNoLmJpbmQodGhpcykpO1xuICAgIGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdidWlsZDplcnJvci1tYXRjaC1maXJzdCcsIHRoaXMubWF0Y2hGaXJzdC5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHV0aWwuaW5oZXJpdHMoRXJyb3JNYXRjaGVyLCBFdmVudEVtaXR0ZXIpO1xuXG4gIEVycm9yTWF0Y2hlci5wcm90b3R5cGUuX2dvdG9OZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICgwID09PSB0aGlzLmN1cnJlbnRNYXRjaC5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmdvdG8odGhpcy5jdXJyZW50TWF0Y2hbMF0uaWQpO1xuICB9O1xuXG4gIEVycm9yTWF0Y2hlci5wcm90b3R5cGUuZ290byA9IGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciBtYXRjaCA9IF8uZmluZFdoZXJlKHRoaXMuY3VycmVudE1hdGNoLCB7IGlkOiBpZCB9KTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsICdDYW5cXCd0IGZpbmQgbWF0Y2ggd2l0aCBpZCAnICsgaWQpO1xuICAgIH1cblxuICAgIC8vIHJvdGF0ZSB0byBuZXh0IG1hdGNoXG4gICAgd2hpbGUgKHRoaXMuY3VycmVudE1hdGNoWzBdICE9PSBtYXRjaCkge1xuICAgICAgdGhpcy5jdXJyZW50TWF0Y2gucHVzaCh0aGlzLmN1cnJlbnRNYXRjaC5zaGlmdCgpKTtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50TWF0Y2gucHVzaCh0aGlzLmN1cnJlbnRNYXRjaC5zaGlmdCgpKTtcblxuICAgIGxldCBmaWxlID0gbWF0Y2guZmlsZTtcbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgJ0RpZCBub3QgbWF0Y2ggYW55IGZpbGUuIERvblxcJ3Qga25vdyB3aGF0IHRvIG9wZW4uJyk7XG4gICAgfVxuXG4gICAgaWYgKCFwYXRoLmlzQWJzb2x1dGUoZmlsZSkpIHtcbiAgICAgIGZpbGUgPSB0aGlzLmN3ZCArIHBhdGguc2VwICsgZmlsZTtcbiAgICB9XG5cbiAgICB2YXIgcm93ID0gbWF0Y2gubGluZSA/IG1hdGNoLmxpbmUgLSAxIDogMDsgLyogQmVjYXVzZSBhdG9tIGlzIHplcm8tYmFzZWQgKi9cbiAgICB2YXIgY29sID0gIG1hdGNoLmNvbCA/IG1hdGNoLmNvbCAtIDEgOiAwOyAvKiBCZWNhdXNlIGF0b20gaXMgemVyby1iYXNlZCAqL1xuXG4gICAgZnMuZXhpc3RzKGZpbGUsIChleGlzdHMpID0+IHtcbiAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgJ01hdGNoZWQgZmlsZSBkb2VzIG5vdCBleGlzdDogJyArIGZpbGUpO1xuICAgICAgfVxuICAgICAgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlLCB7XG4gICAgICAgIGluaXRpYWxMaW5lOiByb3csXG4gICAgICAgIGluaXRpYWxDb2x1bW46IGNvbCxcbiAgICAgICAgc2VhcmNoQWxsUGFuZXM6IHRydWVcbiAgICAgIH0pO1xuICAgICAgdGhpcy5lbWl0KCdtYXRjaGVkJywgbWF0Y2guaWQpO1xuICAgIH0pO1xuICB9O1xuXG4gIEVycm9yTWF0Y2hlci5wcm90b3R5cGUuX3BhcnNlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY3VycmVudE1hdGNoID0gW107XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBtYXRjaEZ1bmN0aW9uID0gZnVuY3Rpb24gKG1hdGNoLCBpLCBzdHJpbmcsIHJlZ2V4KSB7XG4gICAgICBtYXRjaC5pZCA9ICdlcnJvci1tYXRjaC0nICsgc2VsZi5yZWdleC5pbmRleE9mKHJlZ2V4KSArICctJyArIGk7XG4gICAgICB0aGlzLnB1c2gobWF0Y2gpO1xuICAgIH07XG4gICAgdGhpcy5yZWdleC5mb3JFYWNoKChyZWdleCkgPT4ge1xuICAgICAgWFJlZ0V4cC5mb3JFYWNoKHRoaXMub3V0cHV0LCByZWdleCwgbWF0Y2hGdW5jdGlvbiwgdGhpcy5jdXJyZW50TWF0Y2gpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jdXJyZW50TWF0Y2guc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICByZXR1cm4gYS5pbmRleCAtIGIuaW5kZXg7XG4gICAgfSk7XG5cbiAgICB0aGlzLmZpcnN0TWF0Y2hJZCA9ICh0aGlzLmN1cnJlbnRNYXRjaC5sZW5ndGggPiAwKSA/IHRoaXMuY3VycmVudE1hdGNoWzBdLmlkIDogbnVsbDtcblxuICAgIF8uZm9yRWFjaCh0aGlzLmN1cnJlbnRNYXRjaCwgKG1hdGNoLCBpbmRleCkgPT4ge1xuICAgICAgdGhpcy5lbWl0KCdtYXRjaCcsIG1hdGNoWzBdLCBtYXRjaC5pZCk7XG4gICAgfSk7XG4gIH07XG5cbiAgRXJyb3JNYXRjaGVyLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAocmVnZXgsIGN3ZCwgb3V0cHV0KSB7XG4gICAgaWYgKCFyZWdleCkge1xuICAgICAgcmVnZXggPSBbXTtcbiAgICB9XG4gICAgcmVnZXggPSAocmVnZXggaW5zdGFuY2VvZiBBcnJheSkgPyByZWdleCA6IFsgcmVnZXggXTtcblxuICAgIHRoaXMucmVnZXggPSBfLmNvbXBhY3QocmVnZXgubWFwKChyKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gWFJlZ0V4cChyKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0aGlzLmVtaXQoJ2Vycm9yJywgJ0Vycm9yIHBhcnNpbmcgcmVnZXguICcgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0pKTtcblxuICAgIHRoaXMuY3dkID0gY3dkO1xuICAgIHRoaXMub3V0cHV0ID0gb3V0cHV0O1xuICAgIHRoaXMuY3VycmVudE1hdGNoID0gW107XG5cbiAgICB0aGlzLl9wYXJzZSgpO1xuICB9O1xuXG4gIEVycm9yTWF0Y2hlci5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgR29vZ2xlQW5hbHl0aWNzLnNlbmRFdmVudCgnZXJyb3JNYXRjaCcsICdtYXRjaCcpO1xuXG4gICAgdGhpcy5fZ290b05leHQoKTtcbiAgfTtcblxuICBFcnJvck1hdGNoZXIucHJvdG90eXBlLm1hdGNoRmlyc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgR29vZ2xlQW5hbHl0aWNzLnNlbmRFdmVudCgnZXJyb3JNYXRjaCcsICdmaXJzdCcpO1xuXG4gICAgaWYgKHRoaXMuZmlyc3RNYXRjaElkKSB7XG4gICAgICB0aGlzLmdvdG8odGhpcy5maXJzdE1hdGNoSWQpO1xuICAgIH1cbiAgfTtcblxuICBFcnJvck1hdGNoZXIucHJvdG90eXBlLmhhc01hdGNoID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAwICE9PSB0aGlzLmN1cnJlbnRNYXRjaC5sZW5ndGg7XG4gIH07XG5cbiAgcmV0dXJuIEVycm9yTWF0Y2hlcjtcbn0pKCk7XG4iXX0=
//# sourceURL=/home/champ/.atom/packages/build/lib/error-matcher.js
